#!/bin/sh
#
# Welcome to the DTC install maker !
# Maintainer: Thomas GOIRAND <thomas [ at ] goirand.fr>
# please do not ship with you packages
# this is only a small coder tool...
#

VERS=`cat version`
RELS=`cat release`
VERSION=$VERS"-"$RELS
UNIX_TYPE=debian

echo " --- Making DTC debian package --- "

# Make the directories
mkdir -p debian/usr/share/dtc/etc/zones
mkdir -p debian/DEBIAN

# Make the basic archive
./buildRelease $UNIX_TYPE debian/usr/share/dtc

# Copy DTC's files in the good directories
mkdir -p debian/usr/share/doc/dtc
rm debian/usr/share/doc/dtc/LICENSE debian/usr/share/doc/dtc/INSTALL
gzip -f -9 debian/usr/share/doc/dtc/changelog

# Store DTC's package name and version in the control file
echo "Package: dtc
Version: "$VERSION >debian/DEBIAN/control
cat sources/debian/control >>debian/DEBIAN/control

# Make the config file directory and script using standard
# plus debian specific scripts
cp -f sources/debian/prerm sources/debian/config sources/debian/postinst sources/debian/templates debian/DEBIAN
cat sources/setup_mysql_db.sh >>debian/DEBIAN/postinst
cat sources/create_chroot.sh >>debian/DEBIAN/postinst
cat sources/configure_deamons.sh >>debian/DEBIAN/postinst
cat sources/uninstall_deamons.sh >>debian/DEBIAN/prerm

find ./debian -type d | xargs chmod 755

FAKEROOT=`which fakeroot`
if ! [ -x ""${FAKEROOT} ]; then
	echo "You need to \"apt-get install fakeroot\" to build the dtc pacakge"
	exit 1
fi

fakeroot ./buildDebianPackage

mv debian.deb "dtc_"$VERSION"_all.deb"

echo " -- Succesfully made dtc_"$VERSION"_all.deb ---"
