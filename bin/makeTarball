#!/bin/bash
#
# Welcome to the DTC install maker !
# This will produce the tarball package
# Maintainer: Thomas GOIRAND <thomas@goirand.fr>
# please do not ship with you packages
# this is only a small coder tool...
#

VERS=`cat version`
RELS=`cat release`
VERSION=$VERS"-"$RELS

echo " --- Making DTC tarball package ---"

# This block should be common to most unix packages :
mkdir -p dtc/etc/zones
cp -rf ../admin ../client ../shared ../doc dtc/
echo `find dtc/ -iname 'CVS' -exec rm -rf {} \;` >/dev/null >>/dev/null
if ! [ -e dtc/admin/gfx ]
then
	ln -s ../shared/gfx dtc/admin/gfx
fi
if ! [ -e dtc/client/gfx ]
then
	ln -s ../shared/gfx dtc/client/gfx
fi
if ! [ -e dtc/admin/imgcache ]
then
        ln -s ../shared/imgcache dtc/admin/imgcache
fi
if ! [ -e dtc/client/imgcache ]
then
        ln -s ../shared/imgcache dtc/client/imgcache
fi
chown -R root:root dtc
chown nobody:nogroup dtc/shared dtc/client/imgcache dtc/admin/imgcache dtc/client/gfx dtc/admin/gfx

# Specific tarball package actions :
mkdir "dtc_"$VERSION"_all"
mv dtc "dtc_"$VERSION"_all"
cp sources/tarball/install.sh "dtc_"$VERSION"_all"
cat sources/setup_mysql_db.sh >>"dtc_"$VERSION"_all/install.sh"
cat sources/configure_deamons.sh >>"dtc_"$VERSION"_all/install.sh"

cp sources/tarball/uninstall.sh "dtc_"$VERSION"_all"
cat sources/uninstall_deamons.sh >>"dtc_"$VERSION"_all/uninstall.sh"

tar -czf "dtc_"$VERSION"_all.tar.gz" "dtc_"$VERSION"_all"

echo " -- Succesfully made dtc_"$VERSION"_all.tar.gz ---"
