#!/bin/bash
#
# Welcome to the DTC install maker !
# This will produce the tarball package
# Maintainer: Thomas GOIRAND <thomas [ at ] goirand.fr>
# please do not ship with you packages
# this is only a small coder tool...
#

VERS=`cat version`
RELS=`cat release`
VERSION=$VERS"-"$RELS
UNIX_TYPE=gentoo
BUILD_DIR=dtc
DEST_DIR="dtc_"$VERSION"-gentoo"
ARCH_NAME=$DEST_DIR"_all.tar.gz"

./buildRelease $UNIX_TYPE $BUILD_DIR

chown -R root:root $BUILD_DIR
chown nobody:nogroup $BUILD_DIR/client/imgcache $BUILD_DIR/admin/imgcache $BUILD_DIR/shared/imgcache $BUILD_DIR/client/imgcache
chown nobody:nogroup $BUILD_DIR/client/gfx $BUILD_DIR/admin/gfx $BUILD_DIR/shared/gfx $BUILD_DIR/client/gfx
chown nobody:nogroup $BUILD_DIR/admin/*.cgi

# Specific gentoo package actions :
PKG_FILENAME=$DEST_DIR
mv $BUILD_DIR $PKG_FILENAME
cp sources/gentoo/install.sh $PKG_FILENAME
cat sources/create_chroot.sh >>$PKG_FILENAME"/install.sh"
cat sources/setup_mysql_db.sh >>$PKG_FILENAME"/install.sh"
cat sources/configure_deamons.sh >>$PKG_FILENAME"/install.sh"

cp sources/gentoo/uninstall.sh $PKG_FILENAME
cat sources/uninstall_deamons.sh >>$PKG_FILENAME"/uninstall.sh"
echo "===> Packaging"
tar -czf $ARCH_NAME $PKG_FILENAME

echo " -- Succesfully made "$ARCH_NAME" ---"
