<h3><a name="2."></a>2. Installation</h3>

<h4><a name="2.1"></a>2.1 Before installing</h4>

Before installing DTC, apache must be already installed/installable, as
well as php4 (and it's cgi command line version (php4-cgi under debian / php-cgi under BSD)
and the mod_php4 module for apache) and mysql.<br><br>

Installer bind (or any compatible nameserver), qmail et and proftpd with mod_sql
activated and running. Be ready to have one domain name to use (it can be fake,
but beware then that you will have to use tricks to resolve it).<br><br>

Under BSD or under Debian systems, the dependancy does the stuff to install
qmail, apache, mysql and php4 with all necessary modules and options. But
the mysql root password has to be set before so you can give it to DTC installer.
So on all system, you have to install MySQL, and setup a root password on it
PRIOR to install DTC.<br><br>

<h4><a name="2.2"></a>2.2 Configurating daemons before installing</h4>

On all systems, DTC install script will asks some vital questions.
Be ready to answer to the following:<br><br>

- MySQL database hostname<br>
- MySQL root login<br>
- MySQL root password<br>
- A domain name you will use to bind DTC's interface<br>
- The public IP address of the server<br>
- The path were files will be saved for the domains (mail,html) when creating a new account.<br>
- The root admin login/pass you will use with DTC<br><br>

<h5><a name="2.2.1"></a>2.2.1 Mysql</h5>

By default, most Unix distributions install the MySQL server with no admin password.
You have to enter one using this command unther shell prompt:<br><br>

<pre>mysql -uroot -Dmysql</pre><br>

Then issue the following SQL command:<br>
<pre>UPDATE user SET Password=PASSWORD(\'YOUR_ROOT_PASSWORD\') WHERE User=\'root\';
FLUSH PRIVILEGES;</pre>

Note: in case of a lost password, you can launch mysqld with "--skip-grant-tables"
option.
 
<h5><a name="2.2.2"></a>2.2.2 Apache</h5>

You'll have to get your hands dirty editing apache httpd.conf file. Only
3 directives must be set: User, Group and NameServer.<br><br>

You have to setup a default server name for apache, using the same as what you
have setup in /etc/hostname.

<pre>NameServer www.example.com</pre>

Setup apache to use nobody:nogroup for web account,
as long as qmail and proftpd uses same uid/gid also.

<pre>User nobody
Group nogroup</pre>

<h4><a name="2.3"></a>2.3 Installation under Debian</h4>

DTC is not yet in Debian's oficial tree. Before it can once be in it, use the
following alternative source in your /etc/apt/source.list:<br>

<pre>deb ftp://gplhost.com/debian stable main</pre>

This repository also contains compiled versions of qmail-src and ucspi-tcp-src
that are given only on source versions on official repositories (for licence
problems). It's borring not conveinient, so sorry for not complying to licence...<br>
On that repository you will also find the alternative password check from jedi
in a debian package (packaging done by the autor of DTC), and the mysqmail package
that contains a pached version of qmail-pop3d for easy log of pop trafic, a logger,
and another checkpassword for smtp, all the above using MySQL backend.<br><br>

Once this repository added, install DTC like other debian packages:<br>

<pre>apt-get install dtc</pre><br>

BEWARE ! On some case, it can happen that php4-cgi is missconfigured.
In some case mysql.so or some other modules are not activated in
/etc/php4/cgi/php.ini. If it's the case, do it manualy.
Have reegister_globales=0, and safe_mode=1 in your /etc/php4/apache/php.ini.<br><br>

<h4><a name="2.4"></a>2.4 Installation under RedHat</h4>

The actual version of the RPM package for DTC has been done for a 7.3 redhat, but
because it is php scripts it should run on all other superior versions.<br><br>

The RPM package can be downloaded there:<br><br>

<a href="ftp://ftp.gplhost.com/pub/dtc/RPMS">ftp://ftp.gplhost.com/pub/dtc/RPMS</a><br><br>

Installation is done like for any other rpm package:<br>

<pre>rpm -ivh dtc-VERSION_noarch.rpm</pre>

Because it's not possible to ask questions to user before installing a package
under RedHat, there is a post-installation script that will be installed in
/usr/share/dtc/admin/dtc.rpm-install.sh. Simply launch it.<br><br>

<h4><a name="2.5"></a>2.5 Installation under BSD/GENTOO</h4>

A port is being developped. Please standby and use tarball for BSD:

<a href="ftp://ftp.gplhost.com/pub/dtc/bsd">ftp://ftp.gplhost.com/pub/dtc/bsd</a><br><br>

Install script for BSD has been successfully tested, but dependancy are on the way to be
resolved.<br><br>

<h4><a name="2.6"></a>2.6 Manual installation</h4>

First download the tar archive at:<br><br>

<a href="ftp://ftp.gplhost.com/pub/dtc/generic/">ftp://ftp.gplhost.com/pub/dtc/generic/</a><br><br>

Uncompress the archive:<br>
<pre>tar -xvzf dtc_VERSION_all.tar.gz</pre>

Install uncompressed files:<br>
<pre>mkdir -p /usr/share/dtc/etc/zones
mv dtc_VERSION_all/dtc /usr/share
chown -R root:root /usr/share/dtc
chown -R nobody:nogroup /usr/share/dtc/etc</pre>

And launch the install script:<br>
<pre>dtc_VERSION_all/install.sh</pre>

The usual questions will be asked to you plus the path of the folowing
config file that DTC install need to modify: httpd.conf, proftpd.conf, named.conf.<br><br>

Verify that your qmail install reflect something close to the following:<br>
<pre>qmaild:x:64011:65534:qmail daemon,,,:/var/qmail:/bin/sh
qmaill:x:64015:65534:qmail log,,,:/var/qmail:/bin/sh
qmailp:x:64016:65534:qmail pw,,,:/var/qmail:/bin/sh</pre>

If you want to install all by hand without using the install script, here
is how to do:<br><br>

- First, install apache, bind, proftpd with mysql support, and qmail with either mysql support
or using the Jedi's checklocalpasswd program for authentification.
Already done ? You should either be very fast or have debian system installed !<br><br>

- Setup the database the way the "create_table.sql" describe it. You can cut-paste
this file content in phpmyadmin if you like...<br><br>

- Create some folders for dtc to store the generated files :

<pre>
# Create /etc/dtc (conf file), /etc/dtc/data (generated file path)
# and /etc/dtc/data/zone (where named zone files will be stored)
# Folder where dtc will generate it's files for apache, qmail and bind :
mkdir -p /etc/dtc/data/zone
</pre>

- Make this folder accessible by your web user (it should be either nobody or www-data
depending the way things are set up...).
<pre>

chown -R nobody:nogroup /etc/dtc/data;
</pre>

- DTC will generate the following files in the /etc/dtc/data folder. You have to either
replace package files by a symlink to those files, or include these in the package file.
Let's see them one by one. Note that you can change the path to all of them in the
config.inc.php.<br><br>
DTC will generate the folowing files for you : named.zones - named_slave.zones - vhosts.prosites - rcpthosts - virtualdomains - assign - poppasswd<br><br>

* named.zones or named_slave.zones<br>
Include this file in your named.conf (located in /etc/bind under
debian and /etc/namedb under FreeBSD) file using the following syntax :

<pre>
include "/etc/dtc/data/named.zones";
</pre>

* vhosts.conf<br>

Include this in your /etc/apache/httpd.conf :

<pre>
Include /etc/dtc/data/vhosts.prosites
</pre>

* qmail files<br>
You have to replace the qmail files by symlinks to those files :
<pre>
rm /etc/qmail/rcpthosts; ln -s /etc/qmail/rcpthosts /etc/dtc/data/rcpthosts;
rm /etc/qmail/virtualdomains; ln -s /etc/qmail/virtualdomains /etc/dtc/data/virtualdomains;
rm /etc/qmail/users/assign; ln -s /etc/qmail/users/assign /etc/dtc/data/assign
</pre>

If you use the Jedi's checklocalpasswd :
<pre>
rm /etc/poppasswd; ln -s /etc/poppasswd /etc/dtc/data/poppasswd;
</pre>

- You have to add the following directives in /etc/proftpd.conf to enable
sql control :
<pre>
# Beware that one is deprecated in newer version of proftpd:
#	UseReverseDNS   off

	IdentLookups    off
# This is specific to mod_sql for proftpd
	SQLAuthenticate on 
	SQLConnectInfo  YOURDATABASENAME@localhost YOURSQLUSER YOURSQLPASS
	SQLUserInfo     ftp_access login password uid gid homedir shell
	SQLAuthTypes    Plaintext
</pre>
you can also add the following if you need quota support :
<pre>
	Quotas          on
	DefaultQuota    50
	QuotaType       hard
	QuotaCalc       on
	QuotaBlockName  Mbites
	QuotaBlockSize  1024000
	User            nobody
	Group           nogroup
	SQLHomedirOnDemand on
</pre>
You can also add some directives to have FTP accouting done, like the install
script does...

- Next, you have to put all the dtc php file somewhere in your apache tree so you can
browse, click, and enjoy dtc.<br><br>

<h4><a name="2.7"></a>2.7 Post-Installation (protection via .htaccess)</h4>

By default, a .htaccess file is protecting your admin directory (it should be
located in /usr/share/dtc/admin). This file contains something like this:

<pre>AuthName "A funny message prompted to user !"
AuthType Basic
AuthUserFile /var/www/.htpasswd
require valid-user</pre>

That means you have to create a .htpasswrd in /var/www. Issue the following
command to create it (a prompt will ask for password):
<pre>htpasswd -c /var/www/.htpasswd user_name</pre>
The -c option create the file. If it's not specified, then the user will be added
to that auth file.<br><br>

Don't forget that the apache directive AllowOverride tells if you can or not use
.htaccess file. Please set it to correct value or your admin panel wont be protected
and everybody will have access to it (see apache documentation...).<br><br>

In order to have bind (named) working, you have to edit the 'forwarders' part of
the main 'option' derective of named.conf. Fill it with the IP address of an accessible
name server (the one of your ISP). Don't forget to set your /etc/resolv.conf with
the following value:
<pre>nameserver 127.0.0.1
</pre>
Or your server will not resolv correctly.
