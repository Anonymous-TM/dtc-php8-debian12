#!/bin/sh

set -e

action=$1
version=$2

. /usr/share/debconf/confmodule
db_version 2.0

db_input medium dtc/conf_mysqlhost || true
db_input high dtc/conf_mysqllogin || true
db_input high dtc/conf_mysqlpass || true
db_input medium dtc/conf_mysqldb || true
DEBIAN_VERSION=`cat /etc/debian_version`
DEBIAN_VERSION_MINOR=`echo ${DEBIAN_VERSION} | cut -f2 -d"."`
DEBIAN_VERSION_MAJOR=`echo ${DEBIAN_VERSION} | cut -f1 -d"."`

if [ $DEBIAN_VERSION_MAJOR -lt 4 ] ; then
	db_input high dtc/conf_mysql_change_root || true
else
	db_set dtc/conf_mysql_change_root "false"
fi

db_input high dtc/conf_mta_type || true
db_input high dtc/conf_use_cyrus || true
db_input high dtc/conf_apache_version || true
db_input high dtc/main_domainname || true
db_input medium dtc/dtc_adminsubdomain || true
guessed_ip_addr=`ifconfig | head -n 2 | tail -n 1 | cut -f2 -d":" | cut -f1 -d" "`
db_input medium dtc/conf_use_nated_vhosts || true
db_get dtc/conf_use_nated_vhosts
if [ ""$RET = "yes" -o ""$RET = "true" ] ; then
	db_input medium dtc/conf_nated_vhosts_ip || true
	db_input high dtc/conf_ipaddr || true
else
	db_set dtc/conf_nated_vhosts_ip "192.168.0.2"
	db_input high dtc/conf_ipaddr || true
fi
db_input medium dtc/conf_hostingpath || true
db_input low dtc/conf_chroot_path || true
db_input medium dtc/conf_admlogin || true
db_input high dtc/conf_admpass || true
db_input high dtc/conf_gen_ssl_cert || true
db_get dtc/conf_gen_ssl_cert
if [ ""$RET = "yes" -o ""$RET = "true" ] ; then
	db_input high dtc/conf_cert_passphrase || true
	db_input low dtc/conf_cert_countrycode || true
	db_input low dtc/conf_cert_locality || true
	db_input low dtc/conf_cert_organization || true
	db_input low dtc/conf_cert_unit || true
	db_input high dtc/conf_cert_email || true
	db_input high dtc/conf_cert_challenge_pass || true
fi
db_input high dtc/conf_omit_dev_mknod || true
db_input low dtc/conf_dnsbl_list || true

db_get dtc/conf_eth2monitor || true
conf_eth2monitor=$RET
if [ -z "$conf_eth2monitor" ] ; then
	NBRLINES=`grep -v "lo:" /proc/net/dev | wc -l`
	NBRIFACE=$((${NBRLINES} - 2 ))
	CNT=${NBRIFACE}
	ALL_IFACES=''
	while [ ${CNT} -gt 0 ] ; do
		ALL_IFACES=${ALL_IFACES}' '`grep -v "lo:" /proc/net/dev | tail -n ${CNT} | cut -f 1 -d':' | awk -F ' ' '{print $1}' | head -n 1`
		CNT=$((${CNT} - 1 ))
	done
	db_set dtc/conf_eth2monitor "${ALL_IFACES}"
fi
db_input high dtc/conf_eth2monitor || true
db_input medium dtc/conf_report_setup_stat || true
db_go

#DEBHELPER#

exit 0
